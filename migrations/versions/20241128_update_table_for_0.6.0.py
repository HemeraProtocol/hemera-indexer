"""add_failure_records_table
Revision ID: f846e3abeb18
Revises: f846e3abeb18
Create Date: 2024-11-28 18:37:25.662986
"""

from typing import Sequence, Union

import sqlalchemy as sa
from alembic import op
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = "3c7ea7b95dc5"
down_revision: Union[str, None] = "f846e3abeb18"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint("logs_pkey", "logs", type_="primary")
    op.create_primary_key(
        "logs_pkey",
        "logs",
        ["transaction_hash", "block_hash", "log_index"],
    )

    op.drop_constraint(
        "af_holding_balance_uniswap_v3_period_pkey", "af_holding_balance_uniswap_v3_period", type_="primary"
    )
    op.alter_column("af_holding_balance_uniswap_v3_period", "position_token_address", new_column_name="pool_address")
    op.create_primary_key(
        "af_holding_balance_uniswap_v3_period_pkey",
        "af_holding_balance_uniswap_v3_period",
        ["period_date", "protocol_id", "pool_address", "token_id"],
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(
        "af_holding_balance_uniswap_v3_period_pkey", "af_holding_balance_uniswap_v3_period", type_="primary"
    )
    op.alter_column("af_holding_balance_uniswap_v3_period", "pool_address", new_column_name="position_token_address")
    op.create_primary_key(
        "af_holding_balance_uniswap_v3_period_pkey",
        "af_holding_balance_uniswap_v3_period",
        ["period_date", "protocol_id", "position_token_address", "token_id"],
    )

    op.drop_constraint("logs_pkey", "logs", type_="primary")
    op.create_primary_key(
        "logs_pkey",
        "logs",
        ["log_index", "transaction_hash"],
    )
    # ### end Alembic commands ###
